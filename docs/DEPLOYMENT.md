# Deployment Guide

This document provides instructions for deploying the Aetherion Trading Platform.

## Deployment Options

There are two primary ways to deploy Aetherion:

1.  **Docker Compose (Recommended):** The simplest method, suitable for single-server deployments.
2.  **Manual Deployment:** For more complex setups or when Docker Compose is not an option.

## Building & Packaging

The `scripts/deploy.sh` script automates the process of building all services and packaging them into a distributable tarball.

To create a production build, run the following command from the project root:

```bash
./scripts/deploy.sh
```

This will create a `dist` directory containing the compiled binaries, frontend assets, and configuration files, as well as a `.tar.gz` archive.

## Deployment with Docker Compose

This is the recommended method for most use cases.

1.  **Prerequisites:** Ensure Docker and Docker Compose are installed on your server.
2.  **Configuration:** Create a `.env` file in the project root and configure the necessary environment variables (e.g., `AUTH_SECRET`, `CORS_ALLOWED_ORIGINS`, `REACT_APP_GRPC_HOST`).
3.  **Run:**
    ```bash
    docker-compose up -d --build
    ```

## Manual Deployment

For manual deployments, you can use the artifacts generated by the `scripts/deploy.sh` script.

1.  **Transfer Files:** Copy the contents of the `dist` directory to your server.
2.  **Run Services:** You will need to run each service individually. The `dist/README_DEPLOY_ARTIFACTS.txt` file provides basic instructions for this.
3.  **Web Server:** You will need a web server (e.g., Nginx, Apache) to serve the frontend assets from the `dist/frontend` directory.

### Example: Serving the Frontend with Nginx

Below is a basic Nginx configuration for serving the React frontend:

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    root /path/to/your/dist/frontend;
    index index.html;

    location / {
        try_files $uri /index.html;
    }
}
```

## Production Configuration

### Environment Variables

*   `REACT_APP_GRPC_HOST`: The public URL of your gRPC API (e.g., `https://api.yourdomain.com`). This is a build-time variable for the frontend.
*   `CORS_ALLOWED_ORIGINS`: A comma-separated list of allowed origins for CORS (e.g., `https://yourdomain.com,https://www.yourdomain.com`).
*   `AUTH_SECRET`: A strong, random secret for signing JWTs.

### Envoy Hardening

*   **Restrict Domains:** In `envoy.yaml`, replace `"*"` with your specific domains.
*   **TLS:** Use TLS termination for all public-facing traffic.
*   **Rate Limiting:** Implement rate limiting for sensitive RPCs.

### Secure Secrets

*   **`AUTH_SECRET`:** Use a strong, random value (32+ bytes).
*   **Storage:** Store secrets in a secure vault or environment manager, not in the repository.

### Observability

The `trading` service exposes a health check endpoint at `http://localhost:8090/healthz`.